<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start"><ion-menu-button></ion-menu-button></ion-buttons>
    <ion-title>Mon Ã‰quipe</ion-title>
    <ion-buttons slot="end">
      <ion-badge color="light" style="margin-right: 10px; color: var(--ion-color-primary); font-weight:bold;">
        {{ users.length }}
      </ion-badge>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-light">

  <div *ngIf="users.length === 0" class="ion-text-center ion-padding" style="margin-top: 50px;">
    <ion-icon name="person-add" size="large" color="medium"></ion-icon>
    <p class="ion-text-muted">Aucun membre. Invitez votre premier collaborateur !</p>
  </div>

  <ion-list class="team-list">
    
    <ion-item-sliding *ngFor="let u of users">
      
      <ion-item lines="full" [detail]="false">
        <ion-avatar slot="start" [class.admin]="u.role === 'Admin'">
          <span>{{ getInitials(u) }}</span>
        </ion-avatar>

        <ion-label>
          <h2>
            {{ u.full_name || 'Sans nom' }}
            <span *ngIf="u.email === currentUserEmail" class="me-tag">(Moi)</span>
          </h2>
          <p>{{ u.email }}</p>
          <p class="role-tag" [class.admin-text]="u.role === 'Admin'">
            {{ u.role === 'Admin' ? 'ðŸ‘‘ Administrateur' : 'ðŸ‘· ' + u.role }}
          </p>
        </ion-label>
      </ion-item>

      <ion-item-options side="end">
        <ion-item-option color="primary" (click)="openEditModal(u)">
          <ion-icon slot="icon-only" name="create"></ion-icon>
        </ion-item-option>
        
        <ion-item-option color="danger" (click)="deleteUser(u)" *ngIf="u.email !== currentUserEmail">
          <ion-icon slot="icon-only" name="trash"></ion-icon>
        </ion-item-option>
      </ion-item-options>

    </ion-item-sliding>
  </ion-list>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openAddModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-modal [isOpen]="isModalOpen" (didDismiss)="isModalOpen = false" [initialBreakpoint]="0.65" [breakpoints]="[0, 0.65]">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ isEditing ? 'Modifier le membre' : 'Inviter un membre' }}</ion-title>
          <ion-buttons slot="end"><ion-button (click)="isModalOpen = false">Fermer</ion-button></ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content class="ion-padding">
        
        <ion-item fill="outline" class="mb-15">
          <ion-label position="floating">Nom Complet</ion-label>
          <ion-input [(ngModel)]="userData.nom" placeholder="Ex: Michel Durand"></ion-input>
          <ion-icon name="person" slot="start"></ion-icon>
        </ion-item>

        <ion-item fill="outline" class="mb-15">
          <ion-label position="floating">Email Pro</ion-label>
          <ion-input type="email" [(ngModel)]="userData.email" placeholder="michel@btp.com"></ion-input>
          <ion-icon name="mail" slot="start"></ion-icon>
        </ion-item>

        <ion-item fill="outline" class="mb-15">
          <ion-label position="floating">
            {{ isEditing ? 'Nouveau mot de passe (optionnel)' : 'Mot de passe provisoire' }}
          </ion-label>
          <ion-input [(ngModel)]="userData.password" placeholder="***"></ion-input>
          <ion-icon name="key" slot="start"></ion-icon>
        </ion-item>

        <ion-item fill="outline" class="mb-15">
          <ion-label>RÃ´le</ion-label>
          <ion-select [(ngModel)]="userData.role" interface="popover">
            <ion-select-option value="Conducteur">Conducteur de Travaux</ion-select-option>
            <ion-select-option value="Chef">Chef de Chantier</ion-select-option>
            <ion-select-option value="Admin">Administrateur</ion-select-option>
          </ion-select>
          <ion-icon name="business" slot="start"></ion-icon>
        </ion-item>

        <ion-button expand="block" size="large" class="ion-margin-top" (click)="saveUser()">
          {{ isEditing ? 'Enregistrer les modifications' : 'Envoyer l\'invitation' }}
        </ion-button>

      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>
<ion-header>
  <ion-toolbar color="tertiary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/company"></ion-back-button>
    </ion-buttons>
    <ion-title>√âdition DUERP {{ annee }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="downloadPdf()">
        <ion-icon name="download-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding bg-light">

  <div class="info-banner">
    <ion-icon name="information-circle"></ion-icon>
    <p>Ajoutez ici les risques identifi√©s par unit√© de travail.</p>
  </div>

  <div *ngFor="let l of lignes; let i = index" class="risk-card">
    <div class="risk-header">
      <span class="badge-unit">{{ l.unite_travail }}</span>
      <ion-button fill="clear" color="danger" size="small" (click)="removeLine(i)">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </div>

    <ion-grid>
      <ion-row>
        <ion-col size="12">
          <ion-item class="input-item">
            <ion-label position="stacked">T√¢che / Situation</ion-label>
            <ion-input [(ngModel)]="l.tache"></ion-input>
          </ion-item>
        </ion-col>
        
        <ion-col size="8">
          <ion-item class="input-item">
            <ion-label position="stacked">Risque</ion-label>
            <ion-input [(ngModel)]="l.risque"></ion-input>
          </ion-item>
        </ion-col>
        
        <ion-col size="4">
          <ion-item class="input-item">
            <ion-label position="stacked">Gravit√©</ion-label>
            <ion-select [(ngModel)]="l.gravite" interface="popover">
              <ion-select-option [value]="1">1 - Faible</ion-select-option>
              <ion-select-option [value]="2">2 - Moyen</ion-select-option>
              <ion-select-option [value]="3">3 - Grave</ion-select-option>
              <ion-select-option [value]="4">4 - Mortel</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>

        <ion-col size="12">
          <ion-item class="input-item">
            <ion-label position="stacked">‚ö†Ô∏è Mesures √Ä PRENDRE</ion-label>
            <ion-textarea [(ngModel)]="l.mesures_a_realiser" rows="2"></ion-textarea>
          </ion-item>
        </ion-col>

        <ion-col size="12">
          <ion-item class="input-item">
            <ion-label position="stacked">‚úÖ Mesures FAITES</ion-label>
            <ion-textarea [(ngModel)]="l.mesures_realisees" rows="2"></ion-textarea>
          </ion-item>
        </ion-col>

        <ion-col size="12">
          <ion-item class="input-item" lines="none">
            <ion-label position="stacked">√âtat du plan d'action</ion-label>
            <ion-select [(ngModel)]="l.statut" [style.color]="getStatusColor(l.statut)">
              <ion-select-option value="√Ä FAIRE">üî¥ √Ä FAIRE</ion-select-option>
              <ion-select-option value="EN COURS">üü† EN COURS</ion-select-option>
              <ion-select-option value="FAIT">üü¢ FAIT (Ma√Ætris√©)</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>

      </ion-row>
    </ion-grid>
  </div>

  <ion-card class="add-card">
    <ion-card-header>
      <ion-card-subtitle>Nouvelle Ligne</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-item fill="outline" class="mb-2">
        <ion-label position="floating">Unit√© de Travail (ex: Toiture, Bureau...)</ion-label>
        <ion-input [(ngModel)]="newLine.unite_travail"></ion-input>
      </ion-item>

      <ion-item fill="outline" class="mb-2">
        <ion-label position="floating">T√¢che</ion-label>
        <ion-input [(ngModel)]="newLine.tache"></ion-input>
      </ion-item>

      <ion-row>
        <ion-col>
          <ion-item fill="outline">
            <ion-label position="floating">Risque</ion-label>
            <ion-input [(ngModel)]="newLine.risque"></ion-input>
          </ion-item>
        </ion-col>
        <ion-col size="4">
          <ion-item fill="outline">
            <ion-label>Gravit√©</ion-label>
            <ion-select [(ngModel)]="newLine.gravite">
              <ion-select-option [value]="1">1</ion-select-option>
              <ion-select-option [value]="2">2</ion-select-option>
              <ion-select-option [value]="3">3</ion-select-option>
              <ion-select-option [value]="4">4</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-item fill="outline" class="mt-2">
        <ion-label>√âtat initial</ion-label>
        <ion-select [(ngModel)]="newLine.statut">
          <ion-select-option value="√Ä FAIRE">√Ä FAIRE</ion-select-option>
          <ion-select-option value="EN COURS">EN COURS</ion-select-option>
          <ion-select-option value="FAIT">FAIT</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-button expand="block" (click)="addLine()" class="ion-margin-top" [disabled]="!newLine.tache || !newLine.risque">
        <ion-icon name="add-circle" slot="start"></ion-icon>
        Ajouter au DUERP
      </ion-button>
    </ion-card-content>
  </ion-card>

  <div class="spacer"></div>

</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button expand="block" (click)="save()" color="success" size="large">
      <ion-icon name="save-outline" slot="start"></ion-icon>
      ENREGISTRER LE DUERP
    </ion-button>
  </ion-toolbar>
</ion-footer>
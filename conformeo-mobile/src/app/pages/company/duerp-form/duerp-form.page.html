<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>DUERP {{ annee }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="downloadPdf()">
        <ion-icon name="document-text"></ion-icon>
        <span class="ion-hide-sm-down">&nbsp;PDF</span>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding bg-light">

  <ion-text color="medium" class="ion-text-center header-info">
    <p>Ce document est obligatoire et doit Ãªtre mis Ã  jour au moins une fois par an.</p>
  </ion-text>

  <div *ngIf="isLoading" class="ion-text-center ion-padding">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Chargement du document...</p>
  </div>

  <div *ngFor="let ligne of lignes; let i = index">
    <ion-card class="duerp-card ion-margin-bottom">
      
      <ion-card-header class="header-risk">
        <ion-card-title class="flex-between" style="display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem;">
          <span>ðŸ”´ Risque #{{ i + 1 }}</span>
          <ion-button fill="clear" color="danger" (click)="removeLine(i)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item lines="none" class="input-field">
          <ion-label position="stacked">1. TÃ¢ches effectuÃ©es</ion-label>
          <ion-textarea [(ngModel)]="ligne.tache" placeholder="Ex: Utilisation marteau-piqueur" rows="2"></ion-textarea>
        </ion-item>

        <ion-item lines="none" class="input-field">
          <ion-label position="stacked">2. Identification des Risques</ion-label>
          <ion-textarea [(ngModel)]="ligne.risque" placeholder="Ex: Bruit, Vibrations" rows="2"></ion-textarea>
        </ion-item>

        <ion-item lines="none" class="input-field">
          <ion-label position="stacked">3. GravitÃ© * (de 1 Ã  3)</ion-label>
          <ion-select [(ngModel)]="ligne.gravite" interface="popover" placeholder="SÃ©lectionner">
            <ion-select-option [value]="1">ðŸŸ¢ 1 - Faible</ion-select-option>
            <ion-select-option [value]="2">ðŸŸ  2 - Moyen</ion-select-option>
            <ion-select-option [value]="3">ðŸ”´ 3 - Grave/Mortel</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item lines="none" class="input-field">
          <ion-label position="stacked">4. PrÃ©vention RÃ©alisÃ©e</ion-label>
          <ion-textarea [(ngModel)]="ligne.mesures_realisees" placeholder="Ex: Casque anti-bruit fourni" rows="2"></ion-textarea>
        </ion-item>

        <ion-item lines="none" class="input-field">
          <ion-label position="stacked">5. PrÃ©vention Ã  RÃ©aliser</ion-label>
          <ion-textarea [(ngModel)]="ligne.mesures_a_realiser" placeholder="Ex: Formation bruit prÃ©vue" rows="2"></ion-textarea>
        </ion-item>
      </ion-card-content>
    </ion-card>
  </div>

  <ion-button expand="block" fill="outline" class="dashed-btn ion-margin-top" (click)="addLine()">
    <ion-icon name="add" slot="start"></ion-icon> Ajouter un risque
  </ion-button>

  <div class="ion-padding-bottom" style="height: 20px;"></div>

</ion-content>

<ion-footer>
  <ion-toolbar class="ion-padding">
    <ion-button expand="block" (click)="save()" size="large">
      <ion-icon name="save" slot="start"></ion-icon>
      Enregistrer le DUERP
    </ion-button>
  </ion-toolbar>
</ion-footer>
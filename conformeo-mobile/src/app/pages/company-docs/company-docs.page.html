<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start"><ion-back-button defaultHref="/home"></ion-back-button></ion-buttons>
    <ion-title>Documents Entreprise</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding bg-light">

  <div class="alert-banner" *ngIf="hasExpiredDocs">
    <ion-icon name="warning" color="danger"></ion-icon>
    <span>Attention, certains documents obligatoires sont p√©rim√©s !</span>
  </div>

  <ion-list class="doc-list">
    
    <ion-item-sliding *ngFor="let doc of documents">
      <ion-item lines="none" class="doc-item">
        
        <div slot="start" class="doc-icon" [ngClass]="doc.type_doc">
          <ion-icon [name]="getIcon(doc.type_doc)"></ion-icon>
        </div>

        <ion-label>
          <h2>{{ doc.titre }}</h2>
          <p>{{ doc.type_doc }}</p>
          
          <div class="expiration-badge" [class]="getExpirationStatus(doc.date_expiration).color" *ngIf="doc.date_expiration">
            <ion-icon name="calendar-outline"></ion-icon>
            {{ getExpirationStatus(doc.date_expiration).text }}
          </div>
        </ion-label>

        <div slot="end" class="actions-wrapper">
          <ion-button fill="clear" color="dark" (click)="signDocument(doc)">
            <ion-icon name="pencil" slot="icon-only"></ion-icon>
          </ion-button>
          
          <ion-button fill="clear" color="primary" (click)="openDoc(doc.url)">
            <ion-icon name="eye" slot="icon-only"></ion-icon>
          </ion-button>
        </div>

      </ion-item>

      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteDoc(doc.id)">
          <ion-icon name="trash" slot="icon-only"></ion-icon>
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>

  </ion-list>

  <div *ngIf="documents.length === 0" class="empty-state">
    <div class="empty-icon-circle">
      <ion-icon name="folder-open"></ion-icon>
    </div>
    <h3>Aucun document</h3>
    <p>Ajoutez votre DUERP, Assurances, Kbis pour suivre leur validit√©.</p>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="isModalOpen = true">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-modal [isOpen]="isModalOpen" (didDismiss)="isModalOpen = false" [initialBreakpoint]="0.75" [breakpoints]="[0, 0.75]">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Nouveau Document</ion-title>
          <ion-buttons slot="end"><ion-button (click)="isModalOpen = false">Fermer</ion-button></ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content class="ion-padding">
        
        <ion-item fill="outline" class="input-item">
          <ion-label position="floating">Titre du document</ion-label>
          <ion-input [(ngModel)]="newDoc.titre" placeholder="Ex: DUERP 2024"></ion-input>
        </ion-item>

        <ion-item fill="outline" class="input-item">
          <ion-label>Type de document</ion-label>
          <ion-select [(ngModel)]="newDoc.type_doc" interface="popover" placeholder="Choisir...">
            <ion-select-option value="DUERP">üõ°Ô∏è DUERP (Doc Unique)</ion-select-option>
            <ion-select-option value="ASSURANCE">üìÑ Assurance (RC/D√©cennale)</ion-select-option>
            <ion-select-option value="KBIS">üè¢ Kbis / SIRET</ion-select-option>
            <ion-select-option value="AUTRE">üìÇ Autre</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item fill="outline" class="input-item">
          <ion-label>Date d'expiration (Important)</ion-label>
          <ion-datetime-button datetime="datetime"></ion-datetime-button>
          <ion-modal [keepContentsMounted]="true">
            <ng-template>
              <ion-datetime id="datetime" presentation="date" [(ngModel)]="newDoc.date_expiration"></ion-datetime>
            </ng-template>
          </ion-modal>
        </ion-item>

        <div class="file-upload-box" (click)="fileInput.click()" [class.has-file]="selectedFile">
          <input #fileInput type="file" (change)="onFileSelected($event)" hidden accept=".pdf,.jpg,.png,.jpeg">
          <ion-icon [name]="selectedFile ? 'checkmark-circle' : 'cloud-upload-outline'" size="large"></ion-icon>
          <p class="main-text">{{ selectedFile ? selectedFile.name : 'Toucher pour choisir un fichier' }}</p>
          <p class="sub-text" *ngIf="!selectedFile">PDF ou Photo</p>
        </div>

        <ion-button expand="block" class="ion-margin-top action-btn" (click)="uploadDoc()" [disabled]="!selectedFile || !newDoc.titre">
          Enregistrer le document
        </ion-button>

      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>